<!DOCTYPE html>
<html>
<head>
    <title>Class 75 Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pocketbase/0.21.1/pocketbase.umd.js"></script>
</head>
<body class="bg-slate-100 font-sans">
    <div id="login-ui" class="flex flex-col items-center justify-center h-screen">
        <div class="bg-white p-10 rounded-2xl shadow-xl text-center">
            <h1 class="text-3xl font-bold text-slate-800 mb-2">Class Portal</h1>
            <div class="bg-blue-50 text-blue-700 rounded-lg py-2 px-4 mb-6 inline-block">
                <span id="spots-left">Checking spots...</span>
            </div>
            <br>
            <button onclick="login()" class="bg-blue-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-blue-700 transition">Login with Google</button>
        </div>
    </div>

    <script>
       // Replace your old 127.0.0.1 line with this:
const pb = new PocketBase('https://linquid.pockethost.io');

        // Function to update the counter
        async function updateCounter() {
            try {
                const records = await pb.collection('users').getList(1, 1);
                const total = records.totalItems;
                const remaining = 75 - total;
                
                const counterElement = document.getElementById('spots-left');
                if (remaining <= 0) {
                    counterElement.innerText = "CLASS IS FULL (0/75)";
                    counterElement.className = "bg-red-50 text-red-700 rounded-lg py-2 px-4 mb-6 inline-block";
                } else {
                    counterElement.innerText = `Spots Remaining: ${remaining} / 75`;
                }
            } catch (err) {
                console.log("Counter error:", err);
            }
        }

        async function login() {
            try {
                await pb.collection('users').authWithOAuth2({ provider: 'google' });
                location.reload();
            } catch (err) {
                alert("Login Error: " + err.message);
            }
        }

        // Run the counter when the page loads
        updateCounter();
    </script>
</body>

</html>


